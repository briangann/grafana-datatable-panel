{"version":3,"sources":["../src/ctrl.js"],"names":["MetricsPanelCtrl","$","angular","kbn","FileExport","DataTable","transformDataToTable","transformers","DatatableRenderer","panelDefaults","targets","transform","rowsPerPage","showHeader","styles","type","pattern","dateFormat","unit","decimals","colors","colorMode","thresholds","columns","scroll","scrollHeight","fontSize","sort","col","desc","columnAliases","columnWidthHints","sortByColumnsData","sortByColumns","columnData","sortMethod","datatableTheme","themeOptions","light","dark","rowNumbersEnabled","infoEnabled","searchEnabled","showCellBorders","showRowBorders","hoverEnabled","orderColumnEnabled","compactRowsEnabled","stripedRowsEnabled","lengthChangeEnabled","datatablePagingType","pagingTypes","text","value","themes","disabled","DatatablePanelCtrl","$scope","$injector","$http","$location","uiSegmentSrv","annotationsSrv","pageIndex","table","dataRaw","addColumnSegment","newPlusButton","mappingTypes","columnSortMethods","fontSizes","colorModes","columnTypes","unitFormats","getUnitFormats","dateFormats","getColumnNames","_","map","panel","fields","defaults","System","config","paths","getPanelPath","import","grafanaBootData","user","lightTheme","dataLoaded","http","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","actions","push","click","panels","settings","thisPanel","pluginId","thisPanelPath","baseUrl","optionsPath","addEditorTab","datatableOptionsPath","startsWith","substring","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","data","annotations","err","render","dataList","length","emptyData","rows","tmpPanelHeight","height","String","row","replace","actualHeight","parseInt","renderer","isTimezoneUtc","$sanitize","exportTableDataToCsv","render_values","scope","elem","attrs","ctrl","formatters","_this","renderPanel","panelHeight","getPanelHeight","renderData","renderingCompleted","column","without","$q","when","getColumns","segments","c","newSegment","find","plusButton","html","columnStyleDefaults","mappingType","copy","style","subItem","index","ref","defaultRule","columnSortChanged","i","columnNumber","Int32","e","j","sortDirection","defaultAlias","name","alias","columnAliasChanged","defaultHint","width","columnWidthHintsChanged","valueMaps","splice","rangeMaps","from","to","templateUrl"],"mappings":"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","file":"ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport $ from 'jquery';\r\nimport angular from 'angular';\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\nimport * as FileExport from 'app/core/utils/file_export';\r\nimport DataTable from './libs/datatables.net/js/jquery.dataTables.min.js';\r\n\r\n// this is needed for basic datatables.net theme\r\n//import './libs/datatables.net-dt/css/jquery.dataTables.min.css!';\r\n\r\n// See this for styling https://datatables.net/manual/styling/theme-creator\r\n\r\n/*\r\nDark Theme Basic uses these values\r\n\r\ntable section border: #242222 rgb(36,34,34)\r\nrow/cell border: #141414 rgb(20,20,20)\r\nrow background: #1F1D1D  rgb(31,29,29)\r\nrow selected color:  #242222 rgb(36,34,34)\r\ncontrol text: #1FB2E5 rgb(31,178,229)\r\ncontrol text: white  (dataTables_paginate)\r\npaging active button: #242222 rgb(36,34,34)\r\npaging button hover: #111111 rgb(17,17,17)\r\n\r\nwith these modifications:\r\n.dataTables_wrapper .dataTables_paginate .paginate_button {\r\n  color: white\r\n}\r\ntable.dataTable tfoot th {\r\n  color: #1FB2E5;\r\n  font-weight: bold; }\r\n\r\n\r\nLight Theme Basic uses these values\r\n\r\ntable section border: #ECECEC rgb(236,236,236)\r\nrow/cell border: #FFFFFF rgb(255,255,255)\r\nrow background: #FBFBFB  rgb(251,251,251)\r\nrow selected color:  #ECECEC rgb(236,236,236)\r\ncontrol text: black\r\npaging active button: #BEBEBE\r\npaging button hover: #C0C0C0\r\n\r\nwith these modifications:\r\n.dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {\r\n  color: #1fb2e5 !important;\r\ntable.dataTable tfoot th {\r\n  color: #1FB2E5;\r\n  font-weight: bold; }\r\n*/\r\n\r\nimport './css/panel.css!';\r\n// themes attempt to modify the entire page, this \"contains\" the styling to the table only\r\nimport './css/datatables-wrapper.css!';\r\n\r\nimport {\r\n  transformDataToTable,\r\n  transformers\r\n} from './transformers';\r\n\r\nimport { DatatableRenderer } from './renderer';\r\n\r\nconst panelDefaults = {\r\n  targets: [{}],\r\n  transform: 'timeseries_to_columns',\r\n  rowsPerPage: 5,\r\n  showHeader: true,\r\n  styles: [\r\n    {\r\n      type: 'date',\r\n      pattern: 'Time',\r\n      dateFormat: 'YYYY-MM-DD HH:mm:ss',\r\n      },\r\n    {\r\n      unit: 'short',\r\n      type: 'number',\r\n      decimals: 2,\r\n      colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\r\n      colorMode: null,\r\n      pattern: '/.*/',\r\n      thresholds: [],\r\n      }\r\n    ],\r\n  columns: [],\r\n  scroll: false,\r\n  scrollHeight: 'default',\r\n  fontSize: '100%',\r\n  sort: {\r\n    col: 0,\r\n    desc: true\r\n  },\r\n  columnAliases: [],\r\n  columnWidthHints: [],\r\n  sortByColumnsData: [\r\n    [ 0, 'desc' ]\r\n  ],\r\n  sortByColumns: [\r\n    {\r\n      columnData: 0,\r\n      sortMethod: 'desc'\r\n    }\r\n  ],\r\n  datatableTheme: 'basic_theme',\r\n  themeOptions: {\r\n    light: './css/datatable-light.css',\r\n    dark:  './css/datatable-dark.css'\r\n  },\r\n  rowNumbersEnabled: false,\r\n  infoEnabled: true,\r\n  searchEnabled: true,\r\n  showCellBorders: false,\r\n  showRowBorders: true,\r\n  hoverEnabled: true,\r\n  orderColumnEnabled: true,\r\n  compactRowsEnabled: false,\r\n  stripedRowsEnabled: true,\r\n  lengthChangeEnabled: true,\r\n  datatablePagingType: 'simple_numbers',\r\n  pagingTypes: [\r\n    {\r\n      text: 'Page number buttons only',\r\n      value: 'numbers',\r\n    },\r\n    {\r\n      text: \"'Previous' and 'Next' buttons only\",\r\n      value: 'simple'\r\n    },\r\n    {\r\n      text: \"'Previous' and 'Next' buttons, plus page numbers\",\r\n      value: 'simple_numbers'\r\n    },\r\n    {\r\n      text: \"'First', 'Previous', 'Next' and 'Last' buttons\",\r\n      value: 'full'\r\n    },\r\n    {\r\n      text: \"'First', 'Previous', 'Next' and 'Last' buttons, plus page numbers\",\r\n      value: 'full_numbers'\r\n    },\r\n    {\r\n      text: \"'First' and 'Last' buttons, plus page numbers\",\r\n      value: 'first_last_numbers'\r\n    }\r\n  ],\r\n  themes: [\r\n    {\r\n      value: 'basic_theme',\r\n      text: 'Basic',\r\n      disabled: false,\r\n    },\r\n    {\r\n      value: 'bootstrap_theme',\r\n      text: 'Bootstrap',\r\n      disabled: true,\r\n    },\r\n    {\r\n      value: 'foundation_theme',\r\n      text: 'Foundation',\r\n      disabled: true,\r\n    },\r\n    {\r\n      value: 'themeroller_theme',\r\n      text: 'ThemeRoller',\r\n      disabled: true,\r\n    }\r\n  ]\r\n\r\n};\r\n\r\nexport class DatatablePanelCtrl extends MetricsPanelCtrl {\r\n\r\n  constructor($scope, $injector, $http, $location, uiSegmentSrv, annotationsSrv) {\r\n    super($scope, $injector);\r\n\r\n    this.pageIndex = 0;\r\n    this.table = null;\r\n    this.dataRaw = [];\r\n    this.transformers = transformers;\r\n    this.annotationsSrv = annotationsSrv;\r\n    this.uiSegmentSrv = uiSegmentSrv;\r\n    // editor\r\n\r\n    this.addColumnSegment = uiSegmentSrv.newPlusButton();\r\n    this.mappingTypes = [{ text: 'Value to text', value: 1 }, { text: 'Range to text', value: 2 }];\r\n    this.columnSortMethods = [\r\n      {\r\n        text: 'Ascending',\r\n        value: 'asc'\r\n      },\r\n      {\r\n        text: 'Descending',\r\n        value: 'desc'\r\n      },\r\n    ];\r\n\r\n    this.fontSizes = ['80%', '90%', '100%', '110%', '120%', '130%', '150%', '160%', '180%', '200%', '220%', '250%'];\r\n    this.colorModes = [\r\n      {\r\n        text: 'Disabled',\r\n        value: null\r\n      },\r\n      {\r\n        text: 'Cell',\r\n        value: 'cell'\r\n      },\r\n      {\r\n        text: 'Value',\r\n        value: 'value'\r\n      },\r\n      {\r\n        text: 'Row',\r\n        value: 'row'\r\n      },\r\n      {\r\n        text: 'Row Column',\r\n        value: 'rowcolumn'\r\n      },\r\n    ];\r\n    this.columnTypes = [\r\n      {\r\n        text: 'Number',\r\n        value: 'number'\r\n      },\r\n      {\r\n        text: 'String',\r\n        value: 'string'\r\n      },\r\n      {\r\n        text: 'Date',\r\n        value: 'date'\r\n      },\r\n      {\r\n        text: 'Hidden',\r\n        value: 'hidden'\r\n      }\r\n    ];\r\n    this.unitFormats = kbn.getUnitFormats();\r\n    this.dateFormats = [\r\n      {\r\n        text: 'YYYY-MM-DD HH:mm:ss',\r\n        value: 'YYYY-MM-DD HH:mm:ss'\r\n      },\r\n      {\r\n        text: 'MM/DD/YY h:mm:ss a',\r\n        value: 'MM/DD/YY h:mm:ss a'\r\n      },\r\n      {\r\n        text: 'MMMM D, YYYY LT',\r\n        value: 'MMMM D, YYYY LT'\r\n      },\r\n    ];\r\n    // this is used from bs-typeahead and needs to be instance bound\r\n    this.getColumnNames = () => {\r\n      if (!this.table) {\r\n        return [];\r\n      }\r\n      return _.map(this.table.columns, function(col) {\r\n        return col.text;\r\n      });\r\n    };\r\n\r\n    if (this.panel.styles === void 0) {\r\n      this.panel.styles = this.panel.columns;\r\n      this.panel.columns = this.panel.fields;\r\n      delete this.panel.columns;\r\n      delete this.panel.fields;\r\n    }\r\n    _.defaults(this.panel, panelDefaults);\r\n\r\n    System.config({\r\n        paths: {\r\n            \"datatables.net\": this.getPanelPath() + \"libs/datatables.net/js/jquery.dataTables.min\",\r\n            \"datatables.net-bs\" : this.getPanelPath() + \"libs/datatables.net-bs/js/dataTables.bootstrap.min\",\r\n            \"datatables.net-jqui\" : this.getPanelPath() + \"libs/datatables.net-jqui/js/dataTables.jqueryui.min\",\r\n            \"datatables.net-zf\" : this.getPanelPath() + \"libs/datatables.net-zf/js/dataTables.foundation.min\",\r\n        }\r\n    });\r\n\r\n    // basic datatables theme\r\n    // alternative themes are disabled since they affect all datatable panels on same page currently\r\n    switch (this.panel.datatableTheme) {\r\n      case 'basic_theme':\r\n        System.import(this.getPanelPath() +  'libs/datatables.net-dt/css/jquery.dataTables.min.css!');\r\n        if (grafanaBootData.user.lightTheme) {\r\n          System.import(this.getPanelPath() + this.panel.themeOptions.light + '!css');\r\n        } else {\r\n          System.import(this.getPanelPath() + this.panel.themeOptions.dark + \"!css\");\r\n        }\r\n        break;\r\n      case 'bootstrap_theme':\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-bs/js/dataTables.bootstrap.min.js');\r\n        System.import(this.getPanelPath() + 'libs/bootstrap/dist/css/prefixed-bootstrap.min.css!');\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-bs/css/dataTables.bootstrap.min.css!');\r\n        if (!grafanaBootData.user.lightTheme) {\r\n          System.import(this.getPanelPath() + 'css/prefixed-bootstrap-slate.min.css!');\r\n        }\r\n        break;\r\n      case 'foundation_theme':\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-zf/js/dataTables.foundation.min.js');\r\n        System.import(this.getPanelPath() + 'libs/foundation/css/prefixed-foundation.min.css!');\r\n        System.import(this.getPanelPath() + 'libs/datatables.net-zf/css/dataTables.foundation.min.css!');\r\n        break;\r\n      case 'themeroller_theme':\r\n        System.import(this.getPanelPath() +  'libs/datatables.net-jqui/js/dataTables.jqueryui.min.js');\r\n        System.import(this.getPanelPath() +  'libs/datatables.net-jqui/css/dataTables.jqueryui.min.css!');\r\n        System.import(this.getPanelPath() +  'css/jquery-ui-smoothness.css!');\r\n        break;\r\n    default:\r\n        System.import(this.getPanelPath() +  'libs/datatables.net-dt/css/jquery.dataTables.min.css!');\r\n        if (grafanaBootData.user.lightTheme) {\r\n          System.import(this.getPanelPath() + this.panel.themeOptions.light + '!css');\r\n        } else {\r\n          System.import(this.getPanelPath() + this.panel.themeOptions.dark + \"!css\");\r\n        }\r\n        break;\r\n    }\r\n    this.dataLoaded = true;\r\n    this.http = $http;\r\n    this.events.on('data-received', this.onDataReceived.bind(this));\r\n    this.events.on('data-error', this.onDataError.bind(this));\r\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\r\n  }\r\n\r\n  onInitPanelActions(actions) {\r\n      actions.push({\r\n        text: 'Export CSV',\r\n        click: 'ctrl.exportCsv()'\r\n      });\r\n    }\r\n\r\n  // setup the editor\r\n  onInitEditMode() {\r\n    // determine the path to this plugin\r\n    var panels = grafanaBootData.settings.panels;\r\n    var thisPanel = panels[this.pluginId];\r\n    var thisPanelPath = thisPanel.baseUrl + '/';\r\n    // add the relative path to the partial\r\n    var optionsPath = thisPanelPath + 'partials/editor.options.html';\r\n    this.addEditorTab('Options', optionsPath, 2);\r\n    var datatableOptionsPath = thisPanelPath + 'partials/datatables.options.html';\r\n    this.addEditorTab('Datatable Options', datatableOptionsPath, 3);\r\n  }\r\n\r\n  getPanelPath() {\r\n    var panels = grafanaBootData.settings.panels;\r\n    var thisPanel = panels[this.pluginId];\r\n    //\r\n    // For Grafana < 4.6, the system loader preprends publib to the url, add a .. to go back one level\r\n    if (thisPanel.baseUrl.startsWith(\"publib\"))\r\n      return '../' + thisPanel.baseUrl + '/';\r\n    else {\r\n      // Grafana >= 4.6, webpack is used, need to fix the path for imports\r\n      if (thisPanel.baseUrl.startsWith(\"public\")) {\r\n        return thisPanel.baseUrl.substring(7) + '/';\r\n      }\r\n      else {\r\n        // this should never happen, but just in case, append a slash to the url\r\n        return thisPanel.baseUrl + '/';\r\n      }\r\n    }\r\n  }\r\n\r\n  issueQueries(datasource) {\r\n    this.pageIndex = 0;\r\n    if (this.panel.transform === 'annotations') {\r\n      this.setTimeQueryStart();\r\n      return this.annotationsSrv.getAnnotations({\r\n          dashboard: this.dashboard,\r\n          panel: this.panel,\r\n          range: this.range\r\n        })\r\n        .then(annotations => {\r\n          return {\r\n            data: annotations\r\n          };\r\n        });\r\n    }\r\n    return super.issueQueries(datasource);\r\n  }\r\n\r\n  onDataError(err) {\r\n    this.dataRaw = [];\r\n    this.render();\r\n  }\r\n\r\n  onDataReceived(dataList) {\r\n    this.dataRaw = dataList;\r\n    this.pageIndex = 0;\r\n\r\n    // automatically correct transform mode based on data\r\n    if (this.dataRaw && this.dataRaw.length) {\r\n      if (this.dataRaw[0].type === 'table') {\r\n        this.panel.transform = 'table';\r\n      } else {\r\n        if (this.dataRaw[0].type === 'docs') {\r\n          this.panel.transform = 'json';\r\n        } else {\r\n          if (this.panel.transform === 'table' || this.panel.transform === 'json') {\r\n            this.panel.transform = 'timeseries_to_rows';\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.table = transformDataToTable(this.dataRaw, this.panel);\r\n    this.table.sort(this.panel.sort);\r\n    this.panel.emptyData = this.table.rows.length === 0 ||\r\n                           this.table.columns.length === 0;\r\n    return super.render(this.table);\r\n  }\r\n\r\n  getPanelHeight() {\r\n    // panel can have a fixed height set via \"General\" tab in panel editor\r\n    var tmpPanelHeight = this.panel.height;\r\n    if ((typeof tmpPanelHeight === 'undefined') || (tmpPanelHeight === \"\")) {\r\n      // grafana also supplies the height, try to use that if the panel does not have a height\r\n      tmpPanelHeight = String(this.height);\r\n      if (typeof tmpPanelHeight === 'undefined') {\r\n        // height still cannot be determined, get it from the row instead\r\n        tmpPanelHeight = this.row.height;\r\n        if (typeof tmpPanelHeight === 'undefined') {\r\n          // last resort - default to 250px (this should never happen)\r\n          tmpPanelHeight = \"250\";\r\n        }\r\n      }\r\n    }\r\n    // replace px\r\n    tmpPanelHeight = tmpPanelHeight.replace(\"px\",\"\");\r\n    // convert to numeric value\r\n    var actualHeight = parseInt(tmpPanelHeight);\r\n    return actualHeight;\r\n  }\r\n\r\n  exportCsv() {\r\n    var renderer = new DatatableRenderer(this.panel, this.table, this.dashboard.isTimezoneUtc(), this.$sanitize);\r\n    FileExport.exportTableDataToCsv(renderer.render_values());\r\n  }\r\n\r\n  link(scope, elem, attrs, ctrl) {\r\n    var data;\r\n    var panel = ctrl.panel;\r\n    var formatters = [];\r\n    var _this = this;\r\n\r\n    /**\r\n     * [renderPanel description]\r\n     * @return {[type]} [description]\r\n     */\r\n    function renderPanel() {\r\n      var renderer = new DatatableRenderer(panel, ctrl.table, ctrl.dashboard.isTimezoneUtc(), ctrl.$sanitize);\r\n      renderer.render();\r\n      _this.dataLoaded = true;\r\n    }\r\n\r\n    ctrl.panel.panelHeight = this.getPanelHeight();\r\n    ctrl.events.on('render', function(renderData) {\r\n      data = renderData || data;\r\n      if (data) {\r\n        renderPanel();\r\n      }\r\n      ctrl.renderingCompleted();\r\n    });\r\n  }\r\n\r\n  // editor methods\r\n  //\r\n  // cell and row borders cannot both be set at the same time\r\n  showCellBordersChanged() {\r\n    if (this.panel.showCellBorders) {\r\n      this.panel.showRowBorders = false;\r\n    }\r\n    this.render();\r\n  }\r\n\r\n  themeChanged() {\r\n    //console.log(this.panel.datatableTheme);\r\n    this.render();\r\n  }\r\n\r\n  transformChanged() {\r\n    this.panel.columns = [];\r\n    this.render();\r\n  }\r\n  removeColumn(column) {\r\n    this.panel.columns = _.without(this.panel.columns, column);\r\n    this.render();\r\n  }\r\n\r\n  getColumnOptions() {\r\n    if (!this.dataRaw) {\r\n      return this.$q.when([]);\r\n    }\r\n    var columns = this.transformers[this.panel.transform].getColumns(this.dataRaw);\r\n    var segments = _.map(columns, (c) => this.uiSegmentSrv.newSegment({\r\n      value: c.text\r\n    }));\r\n    return this.$q.when(segments);\r\n  }\r\n\r\n  addColumn() {\r\n    var columns = transformers[this.panel.transform].getColumns(this.dataRaw);\r\n    var column = _.find(columns, {\r\n      text: this.addColumnSegment.value\r\n    });\r\n\r\n    if (column) {\r\n      this.panel.columns.push(column);\r\n      this.render();\r\n    }\r\n\r\n    var plusButton = this.uiSegmentSrv.newPlusButton();\r\n    this.addColumnSegment.html = plusButton.html;\r\n    this.addColumnSegment.value = plusButton.value;\r\n  }\r\n\r\n  addColumnStyle() {\r\n      var columnStyleDefaults = {\r\n        unit: 'short',\r\n        type: 'number',\r\n        decimals: 2,\r\n        colors: [\"rgba(245, 54, 54, 0.9)\", \"rgba(237, 129, 40, 0.89)\", \"rgba(50, 172, 45, 0.97)\"],\r\n        colorMode: null,\r\n        pattern: '/.*/',\r\n        dateFormat: 'YYYY-MM-DD HH:mm:ss',\r\n        thresholds: [],\r\n        mappingType: 1,\r\n      };\r\n      this.panel.styles.push(angular.copy(columnStyleDefaults));\r\n  }\r\n  removeColumnStyle(style) {\r\n    this.panel.styles = _.without(this.panel.styles, style);\r\n  }\r\n  setUnitFormat(column, subItem) {\r\n    column.unit = subItem.value;\r\n    this.render();\r\n  }\r\n  invertColorOrder(index) {\r\n    var ref = this.panel.styles[index].colors;\r\n    var copy = ref[0];\r\n    ref[0] = ref[2];\r\n    ref[2] = copy;\r\n    this.render();\r\n  }\r\n\r\n  addColumnSortingRule() {\r\n    var defaultRule = {\r\n      columnData: 0,\r\n      sortMethod: 'desc',\r\n    };\r\n    // check if this column already exists\r\n    this.panel.sortByColumns.push(angular.copy(defaultRule));\r\n    this.columnSortChanged();\r\n  }\r\n\r\n  removeSortByColumn(column) {\r\n    this.panel.sortByColumns = _.without(this.panel.sortByColumns, column);\r\n    this.columnSortChanged();\r\n  }\r\n\r\n  columnSortChanged() {\r\n    // take the values in sortByColumns and convert them into datatables format\r\n    var data = [];\r\n    if (this.panel.sortByColumns.length > 0) {\r\n      for (let i = 0; i < this.panel.sortByColumns.length; i++) {\r\n        // allow numbers and column names\r\n        let columnData = this.panel.sortByColumns[i].columnData;\r\n        let columnNumber = 0;\r\n        try {\r\n          columnNumber = Int32.parseInt(columnData);\r\n        }\r\n        catch(e) {\r\n          // check if empty\r\n          if (columnData === \"\") {\r\n            columnNumber = 0;\r\n          }\r\n          // find the matching column index\r\n          for (let j = 0; j < this.panel.columns.length; j++) {\r\n            if (this.panel.columns[j].text === columnData) {\r\n              columnNumber = j;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        let sortDirection = this.panel.sortByColumns[i].sortMethod;\r\n        data.push([columnNumber, sortDirection]);\r\n      }\r\n    } else {\r\n      // default to column 0, descending\r\n      data.push([0,'desc']);\r\n    }\r\n    this.panel.sortByColumnsData = data;\r\n    this.render();\r\n  }\r\n\r\n  addColumnAlias() {\r\n    var defaultAlias = {\r\n      name: '',\r\n      alias: '',\r\n    };\r\n    // check if this column already exists\r\n    this.panel.columnAliases.push(angular.copy(defaultAlias));\r\n    this.columnAliasChanged();\r\n  }\r\n\r\n  removeColumnAlias(column) {\r\n    this.panel.columnAliases = _.without(this.panel.columnAliases, column);\r\n    this.columnAliasChanged();\r\n  }\r\n\r\n  columnAliasChanged() {\r\n    this.render();\r\n  }\r\n\r\n  addColumnWidthHint() {\r\n    var defaultHint = {\r\n      name: '',\r\n      width: '80px',\r\n    };\r\n    // check if this column already exists\r\n    this.panel.columnWidthHints.push(angular.copy(defaultHint));\r\n    this.columnWidthHintsChanged();\r\n  }\r\n  removeColumnWidthHint(column) {\r\n    this.panel.columnWidthHints = _.without(this.panel.columnWidthHints, column);\r\n    this.columnWidthHintsChanged();\r\n  }\r\n\r\n  columnWidthHintsChanged() {\r\n    this.render();\r\n  }\r\n\r\n  addValueMap(style) {\r\n    if (!style.valueMaps) {\r\n      style.valueMaps = [];\r\n    }\r\n    style.valueMaps.push({ value: '', text: '' });\r\n    this.render();\r\n  }\r\n\r\n  removeValueMap(style, index) {\r\n    style.valueMaps.splice(index, 1);\r\n    this.render();\r\n  }\r\n\r\n  addRangeMap(style) {\r\n    if (!style.rangeMaps) {\r\n      style.rangeMaps = [];\r\n    }\r\n    style.rangeMaps.push({ from: '', to: '', text: '' });\r\n    this.render();\r\n  }\r\n\r\n  removeRangeMap(style, index) {\r\n    style.rangeMaps.splice(index, 1);\r\n    this.render();\r\n  }\r\n\r\n}\r\nDatatablePanelCtrl.templateUrl = 'partials/template.html';\r\n"]}